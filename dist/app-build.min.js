///
const assetsPath="./assets/custom-mono/";const glyphFile="bitmap/bsp0t_";const glyphFileFormat=".png";const srcFontFile=assetsPath+"font/Bsp0tCustom-Mono.ttf";const ZERO='O';const SRC_TXT="BLINDSP"+ZERO+"T";const SRC_FONT_SIZE=126;const SRC_FONT_HEIGHT=126;const SRC_FONT_WIDTH=82;let zeroId;let SRC_FONT;let CONFIG={scale:0.75,maxForce:0.27,maxSpeed:5,arriveMass:0.75,fleeMass:3.5,fleeMaxF:0.37,arriveMaxF:0.3,maxForceMouse:0.7,maxSpeedMouse:5,fleeMaxFMouse:0.8,arriveMaxFMouse:0.64,maxForceZero:0.27,maxSpeedZero:3,fleeMaxFZero:0.31,arriveMaxFZero:0.2,fleeMaxDist:SRC_FONT_WIDTH*0.37*0.75,arriveMaxDist:SRC_FONT_WIDTH*0.36*0.75,glyphPerLine:5};let TXT_WIDTH=0;let TXT_HEIGHT=0;let TEXT_AREA=new p5.Vector();let ZERO_AREA=new p5.Vector();let NB_LINES=Math.ceil(SRC_TXT.length/CONFIG.glyphPerLine);let glyphImgSrc=[];let glyphs=[];let OFFx=0;let OFFy=0;let cnv;let vehicle;let zeroOrigin=new p5.Vector();let areaWander;let padTxtX=0.25;let padTxtY=0.55;let padWanderX=0.75;let padWanderY=0.75;function preload(){for(let i=0;i<SRC_TXT.length;i+=1){let img=loadImage(assetsPath+glyphFile+SRC_TXT[i]+glyphFileFormat);glyphImgSrc.push(img)}SRC_FONT=loadFont(srcFontFile)}function setup(){cnv=createCanvas(windowWidth,windowHeight,WEBGL);var density=displayDensity();pixelDensity(1);checkScreenSize();ZERO_AREA=createVector(SRC_FONT_WIDTH,SRC_FONT_HEIGHT);for(let i=0;i<SRC_TXT.length;i+=1){if(SRC_TXT.charAt(i)==ZERO){zeroId=i}let img=glyphImgSrc[i];let g=new Glyph(SRC_TXT.charAt(i),i,0,0,img);glyphs.push(g)}vehicle=new Vehicle(0,0);areaWander=new Area(0,0,0,0);update()}function draw(){OFFx=TXT_WIDTH*0.5*CONFIG.scale;OFFy=glyphImgSrc[SRC_TXT.length-1].height*NB_LINES*0.5*CONFIG.scale;areaWander.setRect(-OFFx-ZERO_AREA.x*padWanderX*CONFIG.scale,-OFFy-ZERO_AREA.y*padWanderY*CONFIG.scale,(ZERO_AREA.x*padWanderX*2+TEXT_AREA.x)*CONFIG.scale,(ZERO_AREA.y*padWanderY*2+TEXT_AREA.y)*CONFIG.scale);vehicle.update();CONFIG.fleeMaxDist=CONFIG.fleeMaxF*SRC_FONT_WIDTH*CONFIG.scale;CONFIG.arriveMaxDist=CONFIG.arriveMaxF*SRC_FONT_WIDTH*CONFIG.scale;background(0);noStroke();push();translate(-OFFx,-OFFy);for(let i=0;i<glyphs.length;i+=1){glyphs[i].setTarget(vehicle.pos.x+OFFx,vehicle.pos.y+OFFy);glyphs[i].draw()}pop();vehicle.show()}function windowResized(){resizeCanvas(windowWidth,windowHeight);checkScreenSize();update()}function checkScreenSize(){if(windowWidth>=1400){CONFIG.scale=1.5;CONFIG.glyphPerLine=SRC_TXT.length;}else if(windowWidth>=1200){CONFIG.scale=1.25;CONFIG.glyphPerLine=SRC_TXT.length;}else if(windowWidth>=992){CONFIG.scale=1.25;CONFIG.glyphPerLine=5;}else if(windowWidth>=768){CONFIG.scale=1;CONFIG.glyphPerLine=5;}else if(windowWidth>=576){CONFIG.scale=0.75;CONFIG.glyphPerLine=5;}else{CONFIG.scale=0.75;CONFIG.glyphPerLine=5}CONFIG.fleeMaxDist=CONFIG.fleeMaxF*SRC_FONT_WIDTH*CONFIG.scale;CONFIG.arriveMaxDist=CONFIG.arriveMaxF*SRC_FONT_WIDTH*CONFIG.scale}function update(){OFFx=TXT_WIDTH*0.5*CONFIG.scale;OFFy=glyphImgSrc[SRC_TXT.length-1].height*NB_LINES*0.5*CONFIG.scale;vehicle.update();scaleValues();updateTextArea()}function updateTextArea(){let px=0;let py=0;TXT_HEIGHT=0;TXT_WIDTH=0;NB_LINES=Math.ceil(SRC_TXT.length/CONFIG.glyphPerLine);for(let i=0;i<SRC_TXT.length;i+=1){glyphs[i].updatePosition(px,py);if(i==zeroId){let zeroPos=createVector(px*CONFIG.scale,py*CONFIG.scale);zeroOrigin.set(zeroPos);vehicle.origin.set(zeroPos)}px+=glyphImgSrc[i].width;if(i%CONFIG.glyphPerLine==CONFIG.glyphPerLine-1){if(px>TXT_WIDTH){TXT_WIDTH=px}px=0;py+=SRC_FONT_SIZE}}if(px>TXT_WIDTH){TXT_WIDTH=px}TXT_HEIGHT=(glyphs[glyphs.length-1].py+SRC_FONT_SIZE-glyphs[0].py);TEXT_AREA.set(TXT_WIDTH,TXT_HEIGHT)}function scaleValues(){for(let g of glyphs){g.scaleValues()}}const radius=4;class Particle{constructor(x,y,oX,oY,id){this.pos=createVector(x,y);this.initPosition(oX,oY);this.vel=createVector();this.acc=createVector();this.initialRadius=radius;this.initialMaxForce=CONFIG.maxForce;this.initialMaxSpeed=CONFIG.maxSpeed;this.id=id;this.arriveMaxDist=CONFIG.arriveMaxDist;this.fleeMaxDist=CONFIG.fleeMaxDist;this.radius=this.initialRadius;this.maxspeed=this.initialMaxSpeed;this.maxforce=this.initialMaxForce;this.glyphActive=false;this.displayP=false;this.selfValue=0.9+Math.random()*0.2;this.ellipse=false;if(random(1)>0.5){this.ellipse=true}}initPosition(oX,oY){this.origin=createVector(oX,oY);this.displayPos=p5.Vector.mult(this.pos,CONFIG.scale);this.displayPos.add(this.origin);this.target=this.displayPos.copy()}scaleValues(){this.target.set(this.displayPos);this.initialRadius=radius*CONFIG.scale}behaviors(tx,ty){this.maxspeed=CONFIG.maxSpeed*CONFIG.scale*this.selfValue;this.maxforce=CONFIG.maxForce*CONFIG.scale*this.selfValue;this.arriveMaxDist=CONFIG.arriveMaxDist*this.selfValue;this.fleeMaxDist=CONFIG.fleeMaxDist;let arrive=this.arrive(this.target);let mouse=createVector(tx,ty);let flee=this.flee(mouse);arrive.mult(CONFIG.arriveMass);flee.mult(CONFIG.fleeMass);this.applyForce(arrive);this.applyForce(flee)}applyForce(f){this.acc.add(f)}update(){this.displayPos.add(this.vel);this.vel.add(this.acc);let diff=p5.Vector.sub(this.target,this.displayPos);let d=diff.mag();d=Math.min(d,this.fleeMaxDist);if(d>1){this.move=true;this.radius=this.initialRadius;let map_radius=map(d,0,this.fleeMaxDist,this.radius,1);this.radius=map_radius;}else{this.move=false;if(this.glyphActive){this.radius=this.initialRadius;this.displayP=true;}else{if(this.radius>0&&!this.glyphActive){this.radius-=0.5*CONFIG.scale}else{this.radius=0;this.displayP=false}}}this.acc.mult(0)}show(){if(this.displayP||this.glyphActive){noStroke();fill(255);if(this.ellipse){ellipse(this.displayPos.x,this.displayPos.y,this.radius,this.radius)}else{rect(this.displayPos.x-this.radius*0.5,this.displayPos.y-this.radius*0.5,this.radius,this.radius)}}}arrive(target){let desired=p5.Vector.sub(target,this.displayPos);let d=desired.mag();let speed=this.maxspeed;if(d<this.arriveMaxDist){speed=map(d,0,this.arriveMaxDist,0,this.maxspeed)}desired.setMag(speed);let steer=p5.Vector.sub(desired,this.vel);steer.limit(this.maxforce);return steer}flee(target){let desired=p5.Vector.sub(target,this.displayPos);let d=desired.mag();if(d<this.fleeMaxDist){desired.setMag(this.maxspeed);desired.mult(-1);let steer=p5.Vector.sub(desired,this.vel);steer.limit(this.maxforce);return steer}else{return createVector(0,0)}}}class Area{constructor(_xMin,_yMin,_xMax,_yMax){this.setBounds(_xMin,_yMin,_xMax,_yMax)}setBounds(_xMin,_yMin,_xMax,_yMax){this.xMin=_xMin;this.yMin=_yMin;this.xMax=_xMax;this.yMax=_yMax}setRect(_xMin,_yMin,_width,_height){this.xMin=_xMin;this.yMin=_yMin;this.xMax=_xMin+_width;this.yMax=_yMin+_height}getWidth(){return this.xMax-this.xMin}getHeight(){return this.yMax-this.yMin}draw(){rect(this.xMin,this.yMin,this.getWidth(),this.getHeight())}}const spacing=2;class Glyph{constructor(name,id,px,py,img){this.name=name;this.img=img;this.particleMode=false;this.srcPx=px;this.srcPy=py;this.px=px;this.py=py;this.imgPixels=this.getPixels();this.particles=this.pixelsToParticles(this.px,this.py);this.particlesMove=false;this.isActive=false;this.steeringBehavior=false;this.target=createVector(0,0)}updatePosition(px,py){this.srcPx=px;this.srcPy=py;this.px=px;this.py=py;this.updateParticlesPosition()}setTarget(x,y){this.target.set(x,y)}updateTypeSettings(){this.px=this.srcPx;this.py=this.srcPy}draw(){this.particlesMove=false;for(let p of this.particles){if(p.move){this.particlesMove=true;break}}for(let p of this.particles){p.glyphActive=this.particlesMove}this.updateParticles();this.drawParticles();if(!this.particlesMove){this.drawGlyph()}}updateParticles(){for(let p of this.particles){p.behaviors(this.target.x,this.target.y);p.update()}}drawParticles(){for(let p of this.particles){p.show()}}drawGlyph(){push();fill(255);strokeWeight(1);stroke(255,0,0);textFont(SRC_FONT);textSize(SRC_FONT_SIZE*CONFIG.scale);text(this.name,this.px*CONFIG.scale,this.py*CONFIG.scale+this.img.height*CONFIG.scale*0.845);pop()}scaleValues(){for(let p of this.particles){p.scaleValues()}}pixelsToParticles(oX=0,oY=0){let particles=[];let id=0;for(let px of this.imgPixels){particles.push(new Particle(px.x,px.y,oX,oY,id));id+=1}return particles}updateParticlesPosition(){for(let p of this.particles){p.initPosition(this.px*CONFIG.scale,this.py*CONFIG.scale);p.scaleValues()}}getPixels(){let px=[];this.img.loadPixels();for(let x=0;x<this.img.width;x+=1){for(let y=0;y<this.img.height;y+=1){if(x%spacing==0&&y%spacing==0){let index=x+y*this.img.width;let c=this.img.pixels[index*4];let b=brightness(c);if(b>1){px.push({"x":x,"y":y})}}}}return px}}class Vehicle{constructor(x,y){this.pos=createVector(x,y);this.vel=createVector(1,0);this.acc=createVector(0,0);this.mousePos=createVector(0,0);this.origin=this.pos.copy();this.currentTarget=this.origin.copy();this.loopOnZero=true;this.maxSpeed=4;this.maxForce=1.25;this.bounds=areaWander;this.visible=true;this.loopId=0;this.zeroLoopPct=0;this.zeroLoopFrames=90;this.ellapsedFrames=1;this.zeroAdjustX=0.9;this.zeroAdjustY=0.9;}zeroLoop(){this.zeroLoopPct=(this.ellapsedFrames%this.zeroLoopFrames)/this.zeroLoopFrames;let sinPct=Math.sin(TWO_PI*this.zeroLoopPct)*0.9;this.pos.set(this.origin.x-OFFx+SRC_FONT_WIDTH*0.5*CONFIG.scale+Math.cos(3*TWO_PI*this.zeroLoopPct)*ZERO_AREA.x*CONFIG.scale*0.4*this.zeroAdjustX*sinPct,this.origin.y-OFFy+SRC_FONT_HEIGHT*0.5*CONFIG.scale+Math.sin(3*TWO_PI*this.zeroLoopPct)*ZERO_AREA.y*CONFIG.scale*0.5*this.zeroAdjustY*sinPct);this.ellapsedFrames+=1}seek(target,arrival){let force=p5.Vector.sub(target,this.pos);let desiredSpeed=this.maxSpeed;if(arrival){let slowRadius=SRC_FONT_WIDTH*CONFIG.scale;let distance=force.mag();if(distance<slowRadius){desiredSpeed=map(distance,0,slowRadius,0,this.maxSpeed)}}force.setMag(desiredSpeed);force.sub(this.vel);force.limit(this.maxForce);return force}applyForce(force){this.acc.add(force)}update(){this.bounds=areaWander;this.mousePos.set(mouseX-width*0.5,mouseY-height*0.5);if(this.mouseIsInArea()){this.currentTarget.set(this.mousePos);this.maxSpeed=20*CONFIG.scale;this.loopOnZero=false;CONFIG.maxForce=CONFIG.maxForceMouse;CONFIG.maxSpeed=CONFIG.maxSpeedMouse;CONFIG.fleeMaxF=CONFIG.fleeMaxFMouse;CONFIG.arriveMaxF=CONFIG.arriveMaxFMouse;}else{this.currentTarget.set(this.origin.x-OFFx+SRC_FONT_WIDTH*0.5*CONFIG.scale,this.origin.y-OFFy+SRC_FONT_HEIGHT*0.5*CONFIG.scale);if(this.pos.dist(this.currentTarget)<0.1||this.loopOnZero==true){this.loopOnZero=true;this.maxSpeed=0;CONFIG.maxForce=CONFIG.maxForceZero;CONFIG.maxSpeed=CONFIG.maxSpeedZero;CONFIG.fleeMaxF=CONFIG.fleeMaxFZero;CONFIG.arriveMaxF=CONFIG.arriveMaxFZero;this.zeroLoop()}else{this.maxSpeed=24*CONFIG.scale}}let f=this.seek(this.currentTarget,true);this.applyForce(f);this.vel.add(this.acc);this.vel.limit(this.maxSpeed);this.pos.add(this.vel);this.acc.set(0,0)}mouseIsInArea(){if(this.mousePos.x>this.bounds.xMin&&this.mousePos.x<this.bounds.xMax&&this.mousePos.y>this.bounds.yMin&&this.mousePos.y<this.bounds.yMax){return true}else{return false}}show(){push();noStroke();fill(255);translate(this.pos.x-SRC_FONT_WIDTH*CONFIG.scale*0.5,this.pos.y+SRC_FONT_HEIGHT*0.7*CONFIG.scale*0.5);textFont(SRC_FONT);textSize(SRC_FONT_SIZE*CONFIG.scale);text("0",0,0);pop();}}